
import React, { createContext, useContext, useState, ReactNode } from 'react';

export type Language = 'en' | 'fr' | 'zh-CN' | 'zh-TW';

type Translations = Record<string, string>;

const dictionaries: Record<Language, Translations> = {
  en: {
    appTitle: "QQQ Backtester",
    // Config Panel
    profiles: "Profiles",
    addProfile: "Add Profile",
    editProfile: "Edit Profile",
    runComparison: "Run Comparison",
    profileName: "Profile Name",
    chartColor: "Chart Color",
    strategy: "Patrimony Strategy",
    initialCapital: "Initial Capital",
    cashYield: "Cash Yield (Annual %)",
    recurringInv: "Recurring Inv.",
    amount: "Amount",
    freq: "Freq",
    monthly: "Monthly",
    quarterly: "Quarterly",
    yearly: "Yearly",
    targetAllocation: "Portfolio Allocation (Target)",
    contributionAllocation: "Contribution Allocation",
    cash: "Cash",
    dcaCash: "DCA Cash",
    // Strategies
    strat_lumpSum: "Lump Sum + Top-up",
    strat_dca: "DCA Standard",
    strat_rebalance: "DCA + Yearly Rebalance",
    strat_smart: "DCA + Smart Adjust",
    // Leverage
    stockPledge: "Asset Pledge",
    loanRate: "Loan Rate %",
    maxLtv: "Liquidation LTV %",
    maintMargin: "Maint. Margin",
    pledgeRatioQQQ: "QQQ Pledge Ratio (0-1)",
    pledgeRatioQLD: "QLD Pledge Ratio (0-1)",
    pledgeRatioCash: "Cash Pledge Ratio (0-1)",
    annualCashOut: "Annual Cash Out",
    percentOfQqq: "% of Total Portfolio",
    fixedAmount: "Fixed $",
    inflationRate: "Inflation Rate %",
    leverageWarning: "*Collateral = Sum(Asset * Ratio). Liquidation if Debt > Max LTV of this Collateral.",
    riskSafe: "Conservative",
    riskModerate: "Standard",
    riskAggressive: "Aggressive",
    riskCritical: "Critical",
    ltvNote: "LTV and Maintenance Ratio are inverses. Lower LTV = Higher Safety Buffer.",
    // Dashboard
    simulationResults: "Simulation Results",
    comparingPerformance: "Comparing performance across",
    bestBalance: "Best Final Balance",
    bestIrr: "Best IRR",
    lowestDrawdown: "Lowest Max Drawdown",
    bestSharpe: "Best Sharpe Ratio",
    bankruptcyAlert: "Bankruptcy Alert",
    bankruptcyDesc: "The following strategies failed adequacy checks (Debt > Max LTV) and were liquidated:",
    portfolioGrowth: "Portfolio Growth (Net Equity)",
    historicalDrawdown: "Historical Drawdown",
    cashAllocationAnalysis: "Cash Allocation Analysis",
    cashAnalysisDesc: "Visualizing cash drag (left axis) vs absolute cash amount (right axis).",
    equityPct: "Equity %",
    cashPct: "Cash %",
    cashAmount: "Cash Amount",
    perfComparison: "Performance Comparison",
    ltvChartTitle: "LTV / Risk Tracking",
    ltvChartDesc: "Tracks the Loan-to-Value (LTV) ratio over time. Higher LTV increases liquidation risk.",
    betaChartTitle: "Portfolio Beta (Risk Exposure)",
    betaChartDesc: "Weighted average Beta (QQQ=1, QLD=2, Cash=0) relative to Net Equity. Beta > 1 implies leverage.",
    col_strategy: "Strategy",
    col_balance: "Balance",
    col_cagr: "CAGR",
    col_irr: "IRR",
    col_maxDD: "Max DD",
    col_sharpe: "Sharpe",
    // Reports
    viewDetails: "View Details",
    reportTitle: "Financial Reports",
    tabJournal: "Monthly Journal",
    tabBalanceSheet: "Balance Sheet (Semi-Annual)",
    date: "Date",
    event: "Event",
    netCashFlow: "Net Cash Flow",
    assets: "Assets",
    liabilities: "Liabilities",
    equity: "Equity (Net Worth)",
    totalAssets: "Total Assets",
    totalDebt: "Total Debt",
    marginLtv: "LTV %",
    close: "Close",
    shares: "Shares",
    price: "Price",
    // Math Models
    math_title: "Performance Math Models",
    math_cagr: "CAGR",
    math_cagr_expl: "Compound Annual Growth Rate. Measures the mean annual growth rate of an investment assuming profits are reinvested.",
    math_cagr_formula: "CAGR = (End Value / Start Value)^(1/n) - 1",
    math_irr: "IRR",
    math_irr_expl: "Internal Rate of Return. The discount rate that makes the net present value (NPV) of all cash flows equal to zero. Solved via Newton-Raphson method.",
    math_irr_formula: "NPV = Σ (CashFlow_t / (1 + IRR)^t) = 0",
    math_dd: "Max Drawdown",
    math_dd_expl: "The maximum observed loss from a peak to a trough of a portfolio.",
    math_dd_formula: "MaxDD = (Peak Value - Trough Value) / Peak Value",
    math_sharpe: "Sharpe Ratio",
    math_sharpe_expl: "Measures risk-adjusted return. Excess return per unit of deviation.",
    math_sharpe_formula: "Sharpe = (Rp - Rf) / σp",
    // Misc
    done: "Done",
    dataRange: "Data Range",
    appDesc: "Simulates various QQQ (Nasdaq 100) and QLD (2x Leverage) strategies. Create multiple profiles to compare different allocations and patrimony strategies.",
    exportData: "Export All",
    importData: "Import All"
  },
  fr: {
    appTitle: "Backtesteur QQQ",
    profiles: "Profils",
    addProfile: "Ajouter un profil",
    editProfile: "Modifier le profil",
    runComparison: "Lancer la comparaison",
    profileName: "Nom du profil",
    chartColor: "Couleur du graphique",
    strategy: "Stratégie Patrimoniale",
    initialCapital: "Capital Initial",
    cashYield: "Rendement Cash (Annuel %)",
    recurringInv: "Inv. Récurrent",
    amount: "Montant",
    freq: "Fréq.",
    monthly: "Mensuel",
    quarterly: "Trimestriel",
    yearly: "Annuel",
    targetAllocation: "Allocation Portefeuille (Cible)",
    contributionAllocation: "Allocation des Contributions",
    cash: "Cash",
    dcaCash: "DCA Cash",
    strat_lumpSum: "Somme Unique + Apport",
    strat_dca: "DCA Standard",
    strat_rebalance: "DCA + Rééquilibrage Annuel",
    strat_smart: "DCA + Ajustement Intelligent",
    stockPledge: "Nantissement",
    loanRate: "Taux d'emprunt %",
    maxLtv: "LTV Liquidation %",
    maintMargin: "Marge Maint.",
    pledgeRatioQQQ: "Ratio Nantissement QQQ (0-1)",
    pledgeRatioQLD: "Ratio Nantissement QLD (0-1)",
    pledgeRatioCash: "Ratio Nantissement Cash (0-1)",
    annualCashOut: "Retrait Cash Annuel",
    percentOfQqq: "% du Portefeuille Total",
    fixedAmount: "Fixe $",
    inflationRate: "Taux d'inflation %",
    leverageWarning: "*Collatéral = Somme(Actif * Ratio). Faillite si Dette > LTV Max du Collatéral.",
    riskSafe: "Prudent",
    riskModerate: "Standard",
    riskAggressive: "Agressif",
    riskCritical: "Critique",
    ltvNote: "LTV et Marge de Maintien sont inverses. LTV plus bas = Meilleure sécurité.",
    simulationResults: "Résultats de Simulation",
    comparingPerformance: "Comparaison des performances de",
    bestBalance: "Meilleur Solde Final",
    bestIrr: "Meilleur TRI",
    lowestDrawdown: "Drawdown le plus faible",
    bestSharpe: "Meilleur Ratio Sharpe",
    bankruptcyAlert: "Alerte Faillite",
    bankruptcyDesc: "Les stratégies suivantes ont échoué aux contrôles de solvabilité et ont été liquidées :",
    portfolioGrowth: "Croissance du Portefeuille (Actif Net)",
    historicalDrawdown: "Drawdown Historique",
    cashAllocationAnalysis: "Analyse Allocation Cash",
    cashAnalysisDesc: "Visualisation du cash drag (axe gauche) vs montant absolu (axe droit).",
    equityPct: "% Actions",
    cashPct: "% Cash",
    cashAmount: "Montant Cash",
    perfComparison: "Tableau de Performance",
    ltvChartTitle: "Suivi LTV / Risque",
    ltvChartDesc: "Suit le ratio Loan-to-Value (LTV) au fil du temps. Un LTV élevé augmente le risque de liquidation.",
    betaChartTitle: "Beta du Portefeuille (Exposition au Risque)",
    betaChartDesc: "Beta pondéré moyen (QQQ=1, QLD=2, Cash=0) par rapport à l'actif net. Beta > 1 implique un effet de levier.",
    col_strategy: "Stratégie",
    col_balance: "Solde",
    col_cagr: "CAGR",
    col_irr: "TRI",
    col_maxDD: "Max DD",
    col_sharpe: "Sharpe",
    // Reports
    viewDetails: "Détails",
    reportTitle: "Rapports Financiers",
    tabJournal: "Journal Mensuel",
    tabBalanceSheet: "Bilan (Semestriel)",
    date: "Date",
    event: "Événement",
    netCashFlow: "Flux Net",
    assets: "Actifs",
    liabilities: "Passifs",
    equity: "Capitaux Propres",
    totalAssets: "Total Actifs",
    totalDebt: "Dette Totale",
    marginLtv: "LTV %",
    close: "Fermer",
    shares: "Parts",
    price: "Prix",
    // Math Models
    math_title: "Modèles Mathématiques",
    math_cagr: "CAGR",
    math_cagr_expl: "Taux de croissance annuel composé. Mesure le taux de croissance moyen en supposant le réinvestissement des profits.",
    math_cagr_formula: "CAGR = (Valeur Fin / Valeur Début)^(1/n) - 1",
    math_irr: "TRI",
    math_irr_expl: "Taux de Rentabilité Interne. Le taux d'actualisation qui rend la VAN de tous les flux de trésorerie nulle. Résolu via Newton-Raphson.",
    math_irr_formula: "VAN = Σ (Flux_t / (1 + TRI)^t) = 0",
    math_dd: "Drawdown Max",
    math_dd_expl: "La perte maximale observée d'un sommet à un creux.",
    math_dd_formula: "MaxDD = (Sommet - Creux) / Sommet",
    math_sharpe: "Ratio de Sharpe",
    math_sharpe_expl: "Mesure le rendement ajusté au risque. Rendement excédentaire par unité de déviation.",
    math_sharpe_formula: "Sharpe = (Rp - Rf) / σp",
    done: "Terminé",
    dataRange: "Plage de données",
    appDesc: "Simule diverses stratégies QQQ (Nasdaq 100) et QLD (Levier 2x). Créez plusieurs profils pour comparer différentes allocations.",
    exportData: "Exporter tout",
    importData: "Importer tout"
  },
  'zh-CN': {
    appTitle: "QQQ 回测工具",
    profiles: "配置方案",
    addProfile: "添加方案",
    editProfile: "编辑方案",
    runComparison: "运行对比",
    profileName: "方案名称",
    chartColor: "图表颜色",
    strategy: "资产策略",
    initialCapital: "初始资金",
    cashYield: "现金年化收益率 (%)",
    recurringInv: "定投设置",
    amount: "金额",
    freq: "频率",
    monthly: "每月",
    quarterly: "每季",
    yearly: "每年",
    targetAllocation: "目标持仓比例",
    contributionAllocation: "定投分配比例",
    cash: "现金",
    dcaCash: "定投现金",
    strat_lumpSum: "一次性投入 + 追加",
    strat_dca: "标准定投 (DCA)",
    strat_rebalance: "定投 + 年度再平衡",
    strat_smart: "定投 + 智能调整",
    stockPledge: "资产质押融资",
    loanRate: "贷款利率 %",
    maxLtv: "清算线 LTV %",
    maintMargin: "维持率",
    pledgeRatioQQQ: "QQQ 抵押率 (0-1)",
    pledgeRatioQLD: "QLD 抵押率 (0-1)",
    pledgeRatioCash: "现金抵押率 (0-1)",
    annualCashOut: "年度提取现金",
    percentOfQqq: "总资产百分比",
    fixedAmount: "固定金额",
    inflationRate: "通货膨胀率 %",
    leverageWarning: "*有效抵押品 = (QQQ*比率 + QLD*比率 + 现金*比率)。若负债 > 有效抵押品的 Max LTV，将面临清算。",
    riskSafe: "极其保守",
    riskModerate: "标准稳健",
    riskAggressive: "激进",
    riskCritical: "极高风险",
    ltvNote: "LTV 與維持率互為倒數。維持率 167% ≈ LTV 60% (安全)。",
    simulationResults: "模拟结果",
    comparingPerformance: "对比方案数量: ",
    bestBalance: "最高最终余额",
    bestIrr: "最高内部收益率 (IRR)",
    lowestDrawdown: "最低最大回撤",
    bestSharpe: "最高夏普比率",
    bankruptcyAlert: "破产警报",
    bankruptcyDesc: "以下策略未能满足适足率检查 (负债 > Max LTV) 并已被清算：",
    portfolioGrowth: "资产增长趋势 (净值)",
    historicalDrawdown: "历史回撤",
    cashAllocationAnalysis: "现金仓位分析",
    cashAnalysisDesc: "展示现金拖累比例 (左轴) vs 绝对现金金额 (右轴)。",
    equityPct: "股票 %",
    cashPct: "现金 %",
    cashAmount: "现金金额",
    perfComparison: "绩效对比表",
    ltvChartTitle: "风险追踪 (LTV / 维持率)",
    ltvChartDesc: "追踪贷款价值比 (LTV)。LTV 越高，清算风险越大。维持率 = 1 / LTV。",
    betaChartTitle: "投资组合 Beta (风险敞口)",
    betaChartDesc: "基于净资产加权的平均 Beta (QQQ=1, QLD=2, 现金=0)。Beta > 1 意味着带有杠杆。",
    col_strategy: "策略",
    col_balance: "余额",
    col_cagr: "年化回报",
    col_irr: "内部收益率",
    col_maxDD: "最大回撤",
    col_sharpe: "夏普比率",
    // Reports
    viewDetails: "查看明细",
    reportTitle: "详细财务报告",
    tabJournal: "月度流水账",
    tabBalanceSheet: "家庭资产负债表 (半年度)",
    date: "日期",
    event: "交易事件",
    netCashFlow: "净现金流",
    assets: "资产项目",
    liabilities: "负债与权益",
    equity: "净资产 (权益)",
    totalAssets: "总资产",
    totalDebt: "总负债",
    marginLtv: "融资 LTV %",
    close: "关闭",
    shares: "股数",
    price: "市价",
    // Math Models
    math_title: "绩效指标数学模型",
    math_cagr: "复合年均增长率 (CAGR)",
    math_cagr_expl: "假设收益进行再投资的情况下，投资的平均年增长率。不考虑中间的现金流变化。",
    math_cagr_formula: "CAGR = (期末价值 / 期初价值)^(1/年数) - 1",
    math_irr: "内部收益率 (IRR)",
    math_irr_expl: "考虑了资金进出时间（如定投）的真实回报率。它是使所有现金流的净现值 (NPV) 等于零的折现率，使用牛顿迭代法求解。",
    math_irr_formula: "NPV = Σ (现金流_t / (1 + IRR)^t) = 0",
    math_dd: "最大回撤 (Max Drawdown)",
    math_dd_expl: "在选定周期内，任一时间点往后推，可能出现的最大账面损失。",
    math_dd_formula: "MaxDD = (历史峰值 - 历史谷值) / 历史峰值",
    math_sharpe: "夏普比率 (Sharpe)",
    math_sharpe_expl: "衡量风险调整后的收益。即每承受一单位总风险，可以产生多少超额回报。",
    math_sharpe_formula: "Sharpe = (平均回报率 - 无风险利率) / 回报率标准差",
    done: "完成",
    dataRange: "数据范围",
    appDesc: "模拟 QQQ (纳斯达克100) 和 QLD (2倍杠杆) 的多种投资策略。创建多个方案以对比不同的资产配置和现金管理逻辑。",
    exportData: "导出配置",
    importData: "导入配置"
  },
  'zh-TW': {
    appTitle: "QQQ 回測工具",
    profiles: "配置方案",
    addProfile: "新增方案",
    editProfile: "編輯方案",
    runComparison: "執行對比",
    profileName: "方案名稱",
    chartColor: "圖表顏色",
    strategy: "資產策略",
    initialCapital: "初始資金",
    cashYield: "現金年化收益率 (%)",
    recurringInv: "定期定額設定",
    amount: "金額",
    freq: "頻率",
    monthly: "每月",
    quarterly: "每季",
    yearly: "每年",
    targetAllocation: "目標持倉比例",
    contributionAllocation: "定投分配比例",
    cash: "現金",
    dcaCash: "定投現金",
    strat_lumpSum: "單筆投入 + 追加",
    strat_dca: "標準定投 (DCA)",
    strat_rebalance: "定投 + 年度再平衡",
    strat_smart: "定投 + 智能調整",
    stockPledge: "資產質押融資",
    loanRate: "貸款利率 %",
    maxLtv: "清算線 LTV %",
    maintMargin: "維持率",
    pledgeRatioQQQ: "QQQ 抵押率 (0-1)",
    pledgeRatioQLD: "QLD 抵押率 (0-1)",
    pledgeRatioCash: "現金抵押率 (0-1)",
    annualCashOut: "年度提取現金",
    percentOfQqq: "總資產百分比",
    fixedAmount: "固定金額",
    inflationRate: "通貨膨脹率 %",
    leverageWarning: "*有效抵押品 = (QQQ*比率 + QLD*比率 + 現金*比率)。若負債 > 有效抵押品的 Max LTV，將面臨清算。",
    riskSafe: "極其保守",
    riskModerate: "標準穩健",
    riskAggressive: "激進",
    riskCritical: "極高風險",
    ltvNote: "LTV 與維持率互為倒數。維持率 167% ≈ LTV 60% (安全)。",
    simulationResults: "模擬結果",
    comparingPerformance: "對比方案數量: ",
    bestBalance: "最高最終餘額",
    bestIrr: "最高內部收益率 (IRR)",
    lowestDrawdown: "最低最大回撤",
    bestSharpe: "最高夏普比率",
    bankruptcyAlert: "破產警報",
    bankruptcyDesc: "以下策略未能滿足適足率檢查 (負債 > Max LTV) 並已被清算：",
    portfolioGrowth: "資產增長趨勢 (淨值)",
    historicalDrawdown: "歷史回撤",
    cashAllocationAnalysis: "現金倉位分析",
    cashAnalysisDesc: "展示現金拖累比例 (左軸) vs 絕對現金金額 (右軸)。",
    equityPct: "股票 %",
    cashPct: "現金 %",
    cashAmount: "現金金額",
    perfComparison: "績效對比表",
    ltvChartTitle: "風險追蹤 (LTV / 維持率)",
    ltvChartDesc: "追蹤貸款價值比 (LTV)。LTV 越高，清算風險越大。維持率 = 1 / LTV。",
    betaChartTitle: "投資組合 Beta (風險敞口)",
    betaChartDesc: "基於淨資產加權的平均 Beta (QQQ=1, QLD=2, 現金=0)。Beta > 1 意味著帶有槓桿。",
    col_strategy: "策略",
    col_balance: "餘額",
    col_cagr: "年化回報",
    col_irr: "內部收益率",
    col_maxDD: "最大回撤",
    col_sharpe: "夏普比率",
    // Reports
    viewDetails: "查看明細",
    reportTitle: "詳細財務報告",
    tabJournal: "月度流水帳",
    tabBalanceSheet: "家庭資產負債表 (半年度)",
    date: "日期",
    event: "交易事件",
    netCashFlow: "淨現金流",
    assets: "資產項目",
    liabilities: "負債與權益",
    equity: "淨資產 (權益)",
    totalAssets: "總資產",
    totalDebt: "總負債",
    marginLtv: "融資 LTV %",
    close: "關閉",
    shares: "股數",
    price: "市價",
    // Math Models
    math_title: "績效指標數學模型",
    math_cagr: "複合年均增長率 (CAGR)",
    math_cagr_expl: "假設收益進行再投資的情況下，投資的平均年增長率。不考慮中間的現金流變化。",
    math_cagr_formula: "CAGR = (期末價值 / 期初價值)^(1/年數) - 1",
    math_irr: "內部收益率 (IRR)",
    math_irr_expl: "考慮了資金進出時間（如定投）的真實回報率。它是使所有現金流的淨現值 (NPV) 等於零的折現率，使用牛頓迭代法求解。",
    math_irr_formula: "NPV = Σ (現金流_t / (1 + IRR)^t) = 0",
    math_dd: "最大回撤 (Max Drawdown)",
    math_dd_expl: "在選定週期內，任一時間點往後推，可能出現的最大帳面損失。",
    math_dd_formula: "MaxDD = (歷史峰值 - 歷史谷值) / 歷史峰值",
    math_sharpe: "夏普比率 (Sharpe)",
    math_sharpe_expl: "衡量風險調整後的收益。即每承受一單位總風險，可以產生多少超額回報。",
    math_sharpe_formula: "Sharpe = (平均回報率 - 無風險利率) / 回報率標準差",
    done: "完成",
    dataRange: "數據範圍",
    appDesc: "模擬 QQQ (納斯達克100) 和 QLD (2倍槓桿) 的多種投資策略。創建多個方案以對比不同的資產配置和現金管理邏輯。",
    exportData: "匯出配置",
    importData: "匯入配置"
  }
};

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export const LanguageProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<Language>('en');

  const t = (key: string) => {
    return dictionaries[language][key] || key;
  };

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </LanguageContext.Provider>
  );
};

export const useTranslation = () => {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useTranslation must be used within a LanguageProvider');
  }
  return context;
};
